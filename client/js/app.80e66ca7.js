(function(){"use strict";var e={7621:function(e,t,a){var s=a(144),l=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("header",{staticClass:"accent pa-2 mb-4 lime--text text--lighten-5 elevation-5"},[a("h1",{},[e._v("Telephone Oracle")]),a("p",{staticClass:"subtitle-1 font-italic"},[e._v("Pandemic edition")])]),a("v-main",{staticClass:"mx-4"},[e.game?e._e():a("Start",{attrs:{hasError:e.hasGameCodeError},on:{start:e.initGame,join:e.joinGame}}),e.gameDataIsLoaded?a("div",["open"===e.game.status?a("Pregame",{attrs:{game:e.game,localPlayer:e.localPlayer,"player:update":e.storePlayerData}}):e._e(),"active"===e.game.status?a("Game",{attrs:{game:e.game,localPlayer:e.localPlayer,sheet:e.activeSheet}}):e._e(),"complete"===e.game.status?a("Finale",{attrs:{sheets:e.sheets,game:e.game}}):e._e()],1):e._e(),e.gameDataIsLoaded?a("v-container",{attrs:{fluid:""}},[a("v-row",{staticClass:"d-md-flex justify-space-between align-stretch"},[a("Players",{staticClass:"ma-2",attrs:{players:e.players,localPlayer:e.localPlayer,queues:e.queues}}),a("GameInfo",{staticClass:"ma-2",attrs:{game:e.game,progress:e.progress}})],1),a("v-row",{staticClass:"d-flex justify-end"},[a("HostControls",{staticClass:"ma-2",attrs:{isHost:!!e.localPlayer.isHost,status:e.game.status},on:{start:e.startGame,newGame:e.initGame}})],1)],1):e._e()],1)],1)},r=[],n=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("v-btn",{staticClass:"my-4",attrs:{color:"primary"},on:{click:function(t){return e.$emit("start")}}},[e._v("Start a new game ")]),a("form",{staticClass:"mt-4",on:{submit:function(t){return t.preventDefault(),e.joinGame(t)}}},[a("div",{staticClass:"d-md-flex"},[a("v-text-field",{attrs:{clearable:"",label:"Got a game link? Paste it here","aria-describedby":e.hasError?"game-code-invalid":null},model:{value:e.gameLink,callback:function(t){e.gameLink=t},expression:"gameLink"}}),a("v-btn",{staticClass:"ml-md-8 black--text",attrs:{type:"submit",color:"secondary"}},[e._v(" Find game ")])],1),e.hasError?a("p",{attrs:{id:"game-code-invalid"}},[e._v("Please enter a valid game code")]):e._e()])],1)},i=[],o={props:{hasError:{type:Boolean,default:!1}},data(){return{gameLink:null}},methods:{joinGame(){let e=this.gameLink;if(e.startsWith("http")){const t=new URL(e),a=t.search;e=a.replace("?game=","")}this.$emit("join",e)}}},c=o,u=a(3736),d=(0,u.Z)(c,n,i,!1,null,null,null),h=d.exports,m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d-flex flex-column justify-space-between"},[a("ActionPanel",[e.localPlayer.name?a("div",[a("div",{staticClass:"d-md-flex justify-space-between align-center"},[a("h2",[e._v("Welcome "+e._s(e.localPlayer.name)+"!")]),a("v-btn",{staticClass:"my-4 ml-md-4 black--text",attrs:{small:"",color:"secondary"},on:{click:e.copyGameLink}},[a("span",{staticClass:"mr-2"},[e._v("Copy invite link")]),a("v-icon",{attrs:{small:""}},[e._v(" "+e._s(e.copied?"fas fa-clipboard-check":"fas fa-clipboard")+" ")])],1)],1),a("p",{staticClass:"font-italic"},[e._v("Waiting for players to join... ")])]):a("div",[a("h2",[e._v("Please enter your name")]),a("v-form",{on:{submit:function(t){return t.preventDefault(),e.updatePlayer(t)}}},[a("div",{staticClass:"d-md-flex"},[a("v-text-field",{staticClass:"mb-8 mr-md-8",attrs:{label:"Player name",hint:"Please enter your name","persistent-hint":""},model:{value:e.name,callback:function(t){e.name=t},expression:"name"}}),a("v-btn",{staticClass:"black--text",attrs:{type:"submit",color:"secondary"}},[e._v(" Submit ")])],1)])],1)])],1)},p=[],y=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("section",{staticClass:"pa-8"},[e._t("default")],2)},f=[],g={},v=g,_=(0,u.Z)(v,y,f,!1,null,null,null),b=_.exports,P=a(9669),x=a.n(P);x().defaults.baseURL="https://telephone-oracle.herokuapp.com/api";const w=e=>x().post("game",e),C=e=>x().post("/game/start",{id:e}),k=e=>x()({method:"get",url:"game",params:{id:e}}),S=e=>x().get("/player",{params:{id:e}}),I=(e,t)=>x().post("player",{gameId:e,params:t}),j=(e,t)=>x().patch("player",{id:e,params:t}),G=e=>x().get("/line/last",{params:{sheetId:e}}),O=e=>x().post("/line",e),L=e=>x().get("/sheet",{params:{gameId:e}}),q=e=>x().get("/sheet/full",{params:{gameId:e}});var E={name:"Pregame",components:{ActionPanel:b},props:{game:{type:Object,required:!0},localPlayer:{type:Object,required:!0}},data(){return{copied:!1,name:""}},computed:{gameLink(){return`//?game=${this.game.uuid}`}},methods:{copyGameLink(){const e=document.createElement("input");e.value=this.gameLink,document.body.appendChild(e),e.select(),document.execCommand("copy"),document.body.removeChild(e),this.copied=!0},async updatePlayer(){await j(this.localPlayer.uuid,{name:this.name})}}},$=E,A=(0,u.Z)($,m,p,!1,null,null,null),Z=A.exports,D=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ActionPanel",[!e.sheet||e.waiting?a("h2",[e._v("Waiting for the oracle...")]):e.lastLine&&e.lastLine.uuid?a("h2",{staticClass:"font-italic mb-4"},[a("span",[e._v(e._s(e.isQuestion?"Answer:":"Question:"))]),e._v(" "+e._s(e.lastLine.text)+" ")]):a("h2",{staticClass:"mb-4"},[e._v(" Ask the oracle a question ")]),e.sheet?a("div",[a("v-form",{staticClass:"d-md-flex align-start",on:{submit:function(t){return t.preventDefault(),e.addLine(t)}}},[a("v-textarea",{staticClass:"mr-8",attrs:{label:e.label,rows:1,"auto-grow":""},model:{value:e.line,callback:function(t){e.line=t},expression:"line"}}),a("v-btn",{attrs:{type:"submit",color:"primary"}},[e._v(" "+e._s(e.isQuestion?"Submit question":"Submit answer")+" ")])],1)],1):e._e()])},T=[],N={components:{ActionPanel:b},name:"Game",props:{game:{type:Object,required:!0},localPlayer:{type:Object,default:null},sheet:{type:Object,default:null}},data(){return{line:null,lastLine:null,waiting:!1}},computed:{gameIsActive(){return"active"===this.game.status},isQuestion(){return!this.lastLine||!(this.lastLine.order%2)},label(){return this.lastLine?this.isQuestion?"Please enter a question":"Please enter an answer":"Please enter a question for the Oracle"}},methods:{addLine(e){const t=this.line;t?(this.line=null,this.waiting=!0,O({text:t,gameId:this.game.uuid,sheetId:this.sheet.uuid,playerId:this.localPlayer.uuid})):console.error("where is the text")},endGame(){}},watch:{sheet:{async handler(e){if(!e)return;const{data:t}=await G(e.uuid);this.lastLine=t,this.waiting=!1}}}},Q=N,F=(0,u.Z)(Q,D,T,!1,null,null,null),H=F.exports,R=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ActionPanel",[a("h2",{staticClass:"text-center"},[e._v("The Oracle has spoken!")]),e.fullSheets.length?a("div",{staticClass:"d-flex align-center justify-space-between"},[a("div",[e.canGoBack?a("v-btn",{staticClass:"secondary black--text",attrs:{icon:"","aria-label":"previous sheet"},on:{click:function(t){e.currentIndex--}}},[a("i",{staticClass:"fas fa-chevron-left"})]):e._e()],1),a("div",{staticClass:"flex-grow-1"},[a("Sheet",{staticClass:"mt-4 px-4",attrs:{sheet:e.currentSheet}})],1),a("div",[e.canGoForward?a("v-btn",{staticClass:"secondary black--text",attrs:{icon:"","aria-label":"next sheet"},on:{click:function(t){e.currentIndex++}}},[a("i",{staticClass:"fas fa-chevron-right"})]):e._e()],1)]):e._e()])},U=[],B=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticClass:"d-flex align-start"},[a("h3",[e._v("Question: ")]),a("p",{staticClass:"ml-4"},[e._v(e._s(e.firstLineText))])]),a("div",{staticClass:"d-flex align-start"},[a("h3",[e._v("Answer:")]),a("div",{staticClass:"ml-4"},[e.showAnswer?e._e():a("v-btn",{attrs:{text:"",color:"accent"},on:{click:function(t){e.showAnswer=!0}}},[a("span",[e._v("See Oracle's answer")]),a("i",{staticClass:"fas fa-chevron-right ml-4"})])],1),e.showAnswer?a("p",[e._v(" "+e._s(e.lastLineText)+" ")]):e._e()]),e.showAnswer?a("v-dialog",{attrs:{scrollable:""},scopedSlots:e._u([{key:"activator",fn:function(t){var s=t.on;return[a("v-btn",e._g({attrs:{text:"",color:"accent"}},s),[a("span",[e._v("See full sequence")]),a("i",{staticClass:"fas fa-chevron-right ml-4"})])]}}],null,!1,4001529129),model:{value:e.dialog,callback:function(t){e.dialog=t},expression:"dialog"}},[a("v-card",[a("v-card-title",{staticClass:"text-truncate"},[e._v(" "+e._s(e.firstLineText)+" ")]),a("v-card-text",e._l(e.lines,(function(t){return a("p",{key:t.uuid},[e._v(" "+e._s(t.text)+" ")])})),0),a("v-card-actions",[a("v-btn",{on:{click:function(t){e.dialog=!1}}},[e._v("Close")])],1)],1)],1):e._e()],1)},W=[],M={props:{sheet:{type:Object,required:!0}},data(){return{showAnswer:!1,dialog:!1}},computed:{lines(){return this.sheet.lines},firstLineText(){return this.lines.length?this.lines[0].text:""},lastLineText(){const e=this.lines.length;return e?this.lines[e-1].text:""},middleLinesText(){return this.lines.length?this.lines.slice(1,-1).map((e=>e.text)):[]}}},Y=M,z=(0,u.Z)(Y,B,W,!1,null,null,null),J=z.exports,K={components:{Sheet:J,ActionPanel:b},props:{sheets:{type:Array,required:!0},game:{type:Object,required:!0}},data(){return{fullSheets:[],currentIndex:0}},computed:{canGoBack(){return this.currentIndex>0},canGoForward(){return!!this.fullSheets.length&&this.currentIndex<this.fullSheets.length-1},currentSheet(){return this.fullSheets[this.currentIndex]}},async created(){const{data:e}=await q(this.game.uuid);this.fullSheets=e}},V=K,X=(0,u.Z)(V,R,U,!1,null,null,null),ee=X.exports,te=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-col",{staticClass:"elevation-3"},[e.players.length?a("v-list",{attrs:{"min-width":"250px",height:"100%"}},[a("v-subheader",[e._v("Players")]),e._l(e.players,(function(t,s){return a("Player",e._b({key:t.uuid,attrs:{player:t,isUser:e.localPlayer.uuid===t.uuid,order:s}},"Player",e.$attrs,!1))}))],2):e._e()],1)},ae=[],se=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-list-item",{staticClass:"d-flex"},[a("div",{staticClass:"mr-2"},[e._v(e._s(e.name))]),e.isUser?a("div",{staticClass:"mr-2"},[e._v("(You)")]):e._e(),e.player.isHost?a("v-chip",{attrs:{color:"accent",small:""}},[a("i",{staticClass:"fas fa-crown mr-2"}),e._v(" Host ")]):e._e(),e._l(e.queue,(function(t){return a("v-icon",{key:t.uuid,staticClass:"mx-2",attrs:{color:"primary"}},[e._v(" far fa-sticky-note ")])}))],2)},le=[],re={props:{player:{type:Object,required:!0},isUser:{type:Boolean,default:!1},status:{type:String},order:{type:Number,required:!0},queues:{type:Object,required:!0}},computed:{queue(){return this.queues[this.player.uuid]||[]},name(){return this.player.name||`Player${this.order+1}`}}},ne=re,ie=(0,u.Z)(ne,se,le,!1,null,null,null),oe=ie.exports,ce={components:{Player:oe},props:{localPlayer:{type:Object,required:!0},players:{type:Array,default:()=>[]}},data(){return{order:[]}},methods:{updateOrder(){this.$emit("updateOrder",[])}}},ue=ce,de=(0,u.Z)(ue,te,ae,!1,null,null,null),he=de.exports,me=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-col",{staticClass:"elevation-3"},[a("v-subheader",[e._v("Game "+e._s(e.game.uuid))]),a("div",{staticClass:"pa-4 d-flex font-italic justify-space-between align-center"},[a("span",[e._v("Progress:")]),a("v-progress-linear",{staticClass:"ml-4",attrs:{striped:"",value:e.progress,color:"accent",height:24}},[a("div",{staticClass:"lime lighten-4 pa-4 rounded-pill border font-weight-bold"},[e._v(e._s(e.progress+"%")+" ")])])],1)],1)},pe=[],ye={props:{game:{type:Object,required:!0},progress:{type:Number,default:0}}},fe=ye,ge=(0,u.Z)(fe,me,pe,!1,null,null,null),ve=ge.exports,_e=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"d-flex justify-end align-center"},[e.isHost||"open"!==e.status?e._e():a("p",{staticClass:"mr-4 mb-0 red--text text--darken-2 font-italic"},[e._v(" Only the host may start the game ")]),"open"===e.status?a("v-btn",{attrs:{disabled:!e.isHost,color:"primary"},on:{click:function(t){return e.$emit("start")}}},[e._v(" Start Game ")]):e._e(),"complete"===e.status?a("v-btn",{staticClass:"black--text",attrs:{color:"secondary"},on:{click:function(t){return e.$emit("newGame")}}},[e._v("Play again ")]):e._e()],1)},be=[],Pe=(a(6699),{props:{isHost:{type:Boolean,default:!1},status:{type:String,required:!0,validator(e){return["open","active","complete"].includes(e)}}}}),xe=Pe,we=(0,u.Z)(xe,_e,be,!1,null,null,null),Ce=we.exports,ke=a(1157),Se={name:"app",components:{Start:h,Pregame:Z,Game:H,Finale:ee,Players:he,GameInfo:ve,HostControls:Ce},data(){return{game:null,localPlayerId:null,players:null,hasGameCodeError:!1,socket:null,queues:{},sheets:[],progress:0,playerName:null}},computed:{localPlayer(){return this.localPlayerId&&this.players.length?this.players.find((e=>e.uuid===this.localPlayerId)):null},ioNamespace(){return this.game?"https://telephone-oracle.herokuapp.com/"+this.game.uuid:null},activeSheet(){if(!this.localPlayer)return null;const e=this.queues[this.localPlayer.uuid];return e&&e.length?e.reduce(((e,t)=>e&&new Date(e.updatedAt)<=new Date(t.updatedAt)?e:t),null):null},gameDataIsLoaded(){return this.game&&this.players&&this.localPlayer}},watch:{"window.location":{deep:!0,handler:(e,t)=>{e.location!==t.location&&(void 0).getGameFromRoute()}}},created(){this.getGameFromRoute()},beforeDestroy(){this.socket&&this.socket.disconnect()},methods:{async initGame(){const e=window.localStorage.getItem("localPlayerName");e&&(this.playerName=e);const{data:t}=await w({player:{name:this.playerName}});this.game=t.game,this.players=t.players,this.localPlayerId=t.players[0].uuid,this.storePlayerData(),this.initSocket(),this.updateRoute()},initSocket(e){this.socket=(0,ke.ZP)(this.ioNamespace),this.socket.on("connect",(()=>{console.log("connected to socket!")})),this.socket.on("disconnect",(function(){console.log("disconnected!")})),this.socket.on("player:add",(e=>{console.log("player added!"),this.getPlayers()})),this.socket.on("player:update",(e=>{this.handlePlayerUpdate(e)})),this.socket.on("game:start",(e=>{this.players=e.players,this.game=e.game,this.buildQueues(e.sheets)})),this.socket.on("sheet:pass",(e=>{this.buildQueues(e),this.updateProgress(e)})),this.socket.on("game:complete",(e=>{this.buildQueues(e),this.updateProgress(e),this.sheets=e,this.game={...this.game,status:"complete"}}))},async getPlayers(){const{data:e}=await S(this.game.uuid);this.players=e},async joinGame(e){try{const{data:t}=await k(e),{game:a,players:s}=t;if(this.game=a,this.players=s,this.initSocket(a.uuid),this.updateRoute(),this.loadPlayer(),"active"===this.game.status){const{data:e}=await L(this.game.uuid);this.buildQueues(e),this.updateProgress(e)}}catch(t){console.error(t)}},async loadPlayer(){const e=window.localStorage.getItem("localPlayerId"),t=window.localStorage.getItem("localPlayerName");t&&(this.playerName=t),e&&this.players.find((t=>t.uuid===e))?this.localPlayerId=e:(await this.createPlayer(),this.getPlayers())},async createPlayer(){try{const{data:e}=await I(this.game.uuid,{name:this.playerName});this.localPlayerId=e.uuid,this.storePlayerData()}catch(e){console.error(e)}},startGame(){C(this.game.uuid)},storePlayerData(){this.localPlayer&&(this.localPlayerId&&window.localStorage.setItem("localPlayerId",this.localPlayerId),this.localPlayer.name&&window.localStorage.setItem("localPlayerName",this.localPlayer.name))},getGameFromRoute(){const e=window.location.search;if(!e)return;const t=e.replace("?game=","");this.joinGame(t)},updateRoute(){const e=`?game=${this.game.uuid}`;window.history.pushState({path:e},"",e)},handlePlayerUpdate(e){const t=this.players.findIndex((t=>t.uuid===e.uuid)),a=[...this.players];a.splice(t,1,e),this.players=a,e.uuid===this.localPlayerId&&this.storePlayerData()},buildQueues(e){const t={},a=[];this.players.forEach((e=>{t[e.uuid]=[]})),e.forEach((e=>{e.active_player_id?t[e.active_player_id].push(e):a.push(e)})),this.queues=t,this.completedSheets=a},updateProgress(e){const t=this.game.length*this.players.length,a=e.reduce(((e,t)=>e+t.lineCount),0);this.progress=a/t*100}}},Ie=Se,je=(0,u.Z)(Ie,l,r,!1,null,null,null),Ge=je.exports,Oe=a(5464),Le=a.n(Oe),qe=(a(6469),a(6403));s["default"].use(Le());const Ee={theme:{themes:{light:{primary:qe.Z.blue.darken1,secondary:qe.Z.blue.lighten4,accent:qe.Z.indigo.base}}},icons:{iconfont:"fa"}};var $e=new(Le())(Ee);s["default"].config.productionTip=!1,new s["default"]({render:e=>e(Ge),vuetify:$e}).$mount("#app")}},t={};function a(s){var l=t[s];if(void 0!==l)return l.exports;var r=t[s]={exports:{}};return e[s].call(r.exports,r,r.exports,a),r.exports}a.m=e,function(){var e=[];a.O=function(t,s,l,r){if(!s){var n=1/0;for(u=0;u<e.length;u++){s=e[u][0],l=e[u][1],r=e[u][2];for(var i=!0,o=0;o<s.length;o++)(!1&r||n>=r)&&Object.keys(a.O).every((function(e){return a.O[e](s[o])}))?s.splice(o--,1):(i=!1,r<n&&(n=r));if(i){e.splice(u--,1);var c=l();void 0!==c&&(t=c)}}return t}r=r||0;for(var u=e.length;u>0&&e[u-1][2]>r;u--)e[u]=e[u-1];e[u]=[s,l,r]}}(),function(){a.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return a.d(t,{a:t}),t}}(),function(){a.d=function(e,t){for(var s in t)a.o(t,s)&&!a.o(e,s)&&Object.defineProperty(e,s,{enumerable:!0,get:t[s]})}}(),function(){a.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){a.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){var e={143:0};a.O.j=function(t){return 0===e[t]};var t=function(t,s){var l,r,n=s[0],i=s[1],o=s[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(l in i)a.o(i,l)&&(a.m[l]=i[l]);if(o)var u=o(a)}for(t&&t(s);c<n.length;c++)r=n[c],a.o(e,r)&&e[r]&&e[r][0](),e[r]=0;return a.O(u)},s=self["webpackChunktelephone_oracle"]=self["webpackChunktelephone_oracle"]||[];s.forEach(t.bind(null,0)),s.push=t.bind(null,s.push.bind(s))}();var s=a.O(void 0,[998],(function(){return a(7621)}));s=a.O(s)})();
//# sourceMappingURL=app.80e66ca7.js.map